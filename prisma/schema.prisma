generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN_HOLDING
  USER_ANPER
  SUPER_ADMIN
}

// TABEL DIMENSI: Menyimpan daftar perusahaan
model Company {
  id    Int    @id @default(autoincrement()) // <-- Diubah ke Int & autoincrement
  name  String @unique
  type  String // "Holding" atau "Anper"

  headcounts           Headcount[]
  users  User[] // Satu perusahaan bisa memiliki banyak user
  employeeStatusStats  EmployeeStatusStat[]
  educationStats       EducationStat[]
  levelStats           LevelStat[]
  ageStats             AgeStat[]
  lengthOfServiceStats LengthOfServiceStat[]
  productivityStats    ProductivityStat[]
  employeeCostStats   EmployeeCostStat[]
  kpiStats            KpiStat[]
  hcmaScores          HcmaScore[]
  cultureMaturityStats CultureMaturityStat[]
  employeeEngagementStats EmployeeEngagementStat[]
  organizationHealthStats OrganizationHealthStat[]
  organizationStructureStats OrganizationStructureStat[]
  formationRasioStats FormationRasioStat[]
  divisionStats DivisionStat[]
  manpowerPlannings ManpowerPlanning[]
  talentAcquisitionStats   TalentAcquisitionStat[]
  turnoverStats            TurnoverStat[]
  formationRasioGroupedStats FormationRasioGroupedStat[]
  rkapTargets RkapTarget[]
  quartalKpis QuartalKpi[]
}

// --- TABEL FAKTA: Menyimpan data agregat per bulan per perusahaan ---

model Headcount {
  id          Int     @id @default(autoincrement()) // <-- Diubah
  month       Int
  year        Int
  maleCount   Int
  femaleCount Int
  totalCount  Int

  companyId Int     // <-- Diubah ke Int
  company   Company @relation(fields: [companyId], references: [id])

  @@unique([year, month, companyId])
}

model EmployeeStatusStat {
  id             Int     @id @default(autoincrement()) // <-- Diubah
  month          Int
  year           Int
  permanentCount Int
  contractCount  Int

  companyId Int     // <-- Diubah ke Int
  company   Company @relation(fields: [companyId], references: [id])

  @@unique([year, month, companyId])
}

model EducationStat {
  id          Int     @id @default(autoincrement()) // <-- Diubah
  month       Int
  year        Int
  smaSmkCount Int     @map("sma_smk_count") @default(0)
  d3Count     Int     @map("d3_count")
  s1Count     Int     @map("s1_count")
  s2Count     Int     @map("s2_count")
  s3Count     Int     @map("s3_count")

  companyId Int     // <-- Diubah ke Int
  company   Company @relation(fields: [companyId], references: [id])

  @@unique([year, month, companyId])
}

model LevelStat {
  id        Int     @id @default(autoincrement()) // <-- Diubah
  month     Int
  year      Int
  bod1Count Int     @map("bod1_count")
  bod2Count Int     @map("bod2_count")
  bod3Count Int     @map("bod3_count")
  bod4Count Int     @map("bod4_count")

  companyId Int     // <-- Diubah ke Int
  company   Company @relation(fields: [companyId], references: [id])

  @@unique([year, month, companyId])
}

model AgeStat {
  id             Int     @id @default(autoincrement()) // <-- Diubah
  month          Int
  year           Int
  under25Count   Int     @map("under_25_count")
  age26to40Count Int     @map("age_26_40_count")
  age41to50Count Int     @map("age_41_50_count")
  over50Count    Int     @map("over_50_count")

  companyId Int     // <-- Diubah ke Int
  company   Company @relation(fields: [companyId], references: [id])

  @@unique([year, month, companyId])
}

model LengthOfServiceStat {
  id                Int     @id @default(autoincrement()) // <-- Diubah
  month             Int
  year              Int
  los_0_5_Count     Int     @map("los_0_5_count")
  los_6_10_Count    Int     @map("los_6_10_count")
  los_11_15_Count   Int     @map("los_11_15_count")
  los_16_20_Count   Int     @map("los_16_20_count")
  los_21_25_Count   Int     @map("los_21_25_count")
  los_25_30_Count   Int     @map("los_25_30_count")
  los_over_30_Count Int     @map("los_over_30_count")

  companyId Int     // <-- Diubah ke Int
  company   Company @relation(fields: [companyId], references: [id])

  @@unique([year, month, companyId])
}

model ProductivityStat {
  id        Int     @id @default(autoincrement()) // <-- Diubah
  month     Int
  year      Int
  revenue   Float
  netProfit Float
  totalEmployeeCost Float @default(0)
  totalCost         Float   @default(0)

  companyId Int     // <-- Diubah ke Int
  company   Company @relation(fields: [companyId], references: [id])

  @@unique([year, month, companyId])
}

model EmployeeCostStat {
  id              Int   @id @default(autoincrement())
  month           Int
  year            Int
  companyId       Int
  
  managementCost  Float @default(0) @map("management_cost")
  employeeCost    Float @default(0) @map("employee_cost")
  recruitment     Float @default(0)
  secondment      Float @default(0)
  others          Float @default(0)
  total           Float @default(0) // Kolom Total dari Excel

  company         Company @relation(fields: [companyId], references: [id])
  @@unique([year, month, companyId])
}

model KpiStat {
  id                       Int   @id @default(autoincrement())
  month                    Int
  year                     Int
  companyId                Int

  // 7 KPI Fields Baru (Float untuk menerima angka desimal/skor)
  kpiFinansial             Float @default(0)
  kpiOperasional           Float @default(0)
  kpiSosial                Float @default(0)
  kpiInovasiBisnis         Float @default(0) @map("kpi_inovasi_bisnis")
  kpiKepemimpinanTeknologi Float @default(0) @map("kpi_kepemimpinan_teknologi")
  kpiPeningkatanInvestasi  Float @default(0) @map("kpi_peningkatan_investasi")
  kpiPengembanganTalenta   Float @default(0) @map("kpi_pengembangan_talenta")

  // Skor total (jika ada, untuk kalkulasi ringkasan)
  totalScore               Float @default(0)

  company                  Company @relation(fields: [companyId], references: [id])
  @@unique([year, month, companyId])
}

model HcmaScore {
  id                    Int     @id @default(autoincrement())
  year                  Int
  
  // Indikator Skor (sesuai mockup, tipe data Float untuk angka desimal)
  talentSuccession      Float
  rewardRecognition     Float
  learningDevelopment   Float
  performanceGoal       Float
  capacityStrategy      Float
  behaviourCulture      Float
  humanCapitalIt        Float
  leadership            Float
  
  // Total Skor
  totalScore            Float
  ifgAverageScore      Float   @default(0)

  // Relasi ke Company
  companyId             Int
  company               Company @relation(fields: [companyId], references: [id])

  @@unique([year, companyId])
}

model CultureMaturityStat {
  id          Int     @id @default(autoincrement())
  year        Int
  companyId   Int
  
  amanah      Float
  kompeten    Float
  harmonis    Float
  loyal       Float
  adaptif     Float
  kolaboratif Float
  totalScore  Float

  company     Company @relation(fields: [companyId], references: [id])

  @@unique([year, companyId])
}

model EmployeeEngagementStat {
  id         Int     @id @default(autoincrement())
  year       Int
  companyId  Int
  
  say        Float
  stay       Float
  strive     Float
  totalScore Float

  company    Company @relation(fields: [companyId], references: [id])

  @@unique([year, companyId])
}

model OrganizationHealthStat {
  id                    Int     @id @default(autoincrement())
  year                  Int
  companyId             Int

  // 9 Indikator Baru
  accountability        Float
  motivation            Float
  coordinationControl   Float   @map("coordination_control")
  leadership            Float
  innovationLearning    Float   @map("innovation_learning")
  externalOrientation   Float   @map("external_orientation")
  direction             Float
  capabilities          Float
  workEnvironment       Float   @map("work_environment")

  // Skor total
  totalScore            Float

  company               Company @relation(fields: [companyId], references: [id])

  @@unique([year, companyId])
}

model OrganizationStructureStat {
  id                    Int     @id @default(autoincrement())
  year                  Int
  companyId             Int

  // Data untuk Chart "Employee Formation Rasio"
  risikoTataKelola      Float   @map("risiko_tata_kelola")
  sdmUmum               Float   @map("sdm_umum")
  keuangan              Float
  it                    Float
  operasional           Float
  bisnis                Float
  cabang                Float

  // Data untuk Kartu Informasi
  enablerCount          Int     @map("enabler_count")
  revenueGeneratorCount Int     @map("revenue_generator_count")
  divisionCount         Int     @map("division_count")
  departmentCount       Int     @map("department_count")
  avgSpanDepartment     Int     @map("avg_span_department")
  avgSpanEmployee       Int     @map("avg_span_employee")

  company               Company @relation(fields: [companyId], references: [id])

  @@unique([year, companyId])
}

model FormationRasioStat {
  id                    Int @id @default(autoincrement())
  year                  Int
  month                 Int
  companyId             Int
  
  // 10 Kategori Baru (dalam Bahasa Inggris & camelCase)
  rd                    Int @default(0) @map("research_development")
  business              Int @default(0)
  finance               Int @default(0)
  humanResources        Int @default(0) @map("human_resources")
  actuary               Int @default(0)
  compliance            Int @default(0)
  legal                 Int @default(0)
  informationTechnology Int @default(0) @map("information_technology")
  corporateSecretary    Int @default(0) @map("corporate_secretary")
  generalAffairs        Int @default(0) @map("general_affairs")

  company               Company @relation(fields: [companyId], references: [id])

  @@unique([year, month, companyId])
}

model ManpowerPlanning {
  id           Int     @id @default(autoincrement())
  year         Int
  month        Int
  companyId    Int
  
  plannedCount Int // Jumlah karyawan yang direncanakan

  company      Company @relation(fields: [companyId], references: [id])

  @@unique([year, month, companyId])
}

model DivisionStat {
  id           Int    @id @default(autoincrement())
  year         Int
  month        Int
  companyId    Int
  
  divisionName String // Nama Divisi, misal "Sumber Daya Manusia"
  Kategori     String @default("Umum")
  plannedCount Int    // Man Power Planning untuk divisi ini
  actualCount  Int    // Headcount aktual untuk divisi ini

  company      Company @relation(fields: [companyId], references: [id])

  @@unique([year, month, companyId, divisionName])
}

model TalentAcquisitionStat {
  id           Int     @id @default(autoincrement())
  month        Int
  year         Int
  companyId    Int

  newHireCount Int     @default(0) // Jumlah karyawan baru di bulan tsb
  costOfHire   Float   @default(0) // Biaya rekrutmen di bulan tsb (dalam Juta)
  newHireRetention  Float   @default(0)

  company      Company @relation(fields: [companyId], references: [id])
  @@unique([year, month, companyId])
}

model TurnoverStat {
  id          Int     @id @default(autoincrement())
  month       Int
  year        Int
  companyId   Int

  resignCount Int     @default(0) // Jumlah karyawan resign di bulan tsb

  company     Company @relation(fields: [companyId], references: [id])
  @@unique([year, month, companyId])
}

model FormationRasioGroupedStat {
  id         Int @id @default(autoincrement())
  year       Int
  month      Int
  companyId  Int

  // 7 Kategori Baru
  strategy   Int @default(0)
  business   Int @default(0)
  finance    Int @default(0)
  hcGa       Int @default(0) @map("hc_ga")
  operation  Int @default(0)
  compliance Int @default(0)
  it         Int @default(0)

  company    Company @relation(fields: [companyId], references: [id])

  @@unique([year, month, companyId])
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  password  String   // Ini akan menyimpan password yang SUDAH DI-HASH
  role      UserRole @default(USER_ANPER)

  // Relasi: Setiap User dimiliki oleh satu Company
  companyId Int
  company   Company @relation(fields: [companyId], references: [id])
}

model RkapTarget {
  id        Int   @id @default(autoincrement())
  year      Int
  companyId Int

  // Target untuk metrik produktivitas
  revenue   Float @default(0)
  netProfit Float @default(0)

  // Target untuk metrik biaya karyawan
  totalEmployeeCost Float @default(0) @map("total_employee_cost")

  // Relasi ke Company
  company   Company @relation(fields: [companyId], references: [id])

  @@unique([year, companyId]) // Setiap perusahaan hanya punya 1 set target RKAP per tahun
}

model QuartalKpi {
  id               Int      @id @default(autoincrement())
  year             Int
  quarter          Int      // 1, 2, 3, or 4
  companyId        Int

  kpiName          String   @map("kpi_name")
  kpiCategory      String   @map("kpi_category")
  weight           Float    // Bobot, misal: 6% disimpan sebagai 0.06
  achievementScore Float    @map("achievement_score") // Skor Capaian, misal: 46.8% disimpan sebagai 0.468

  company          Company  @relation(fields: [companyId], references: [id])

  @@unique([year, quarter, companyId, kpiName])
}